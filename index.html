<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MoodSpace üåç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a"/>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    #map {
      height: 420px;
      border-radius: 16px;
      overflow: hidden;
    }

    /* Soft pulse marker */
    .pulse {
      background: rgba(99, 102, 241, 0.9);
      border-radius: 50%;
      width: 14px;
      height: 14px;
      position: relative;
    }
    .pulse::after {
      content: '';
      width: 14px;
      height: 14px;
      border-radius: 50%;
      position: absolute;
      left: 0;
      top: 0;
      animation: pulse 2s infinite;
      background: rgba(99, 102, 241, 0.4);
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(3); opacity: 0; }
    }
  </style>
</head>

<body class="bg-slate-100 text-slate-900">

<div class="max-w-5xl mx-auto p-4 space-y-6">

  <!-- Header -->
  <header class="text-center space-y-1">
    <h1 class="text-3xl font-bold">MoodSpace üåç</h1>
    <p class="text-slate-600">Arrive. Reflect. Record.</p>
  </header>

  <!-- Map -->
  <div id="map"></div>

  <!-- Mood Panel (revealed after zoom) -->
  <div id="moodPanel" class="hidden bg-white rounded-xl shadow p-4 space-y-3">
    <h2 class="text-lg font-semibold">How do you feel here?</h2>
    <div class="flex gap-2 flex-wrap">
      <button class="px-3 py-2 rounded-lg bg-indigo-100">üòä Calm</button>
      <button class="px-3 py-2 rounded-lg bg-indigo-100">üòî Heavy</button>
      <button class="px-3 py-2 rounded-lg bg-indigo-100">‚ö° Energised</button>
      <button class="px-3 py-2 rounded-lg bg-indigo-100">üòå Grateful</button>
    </div>
    <textarea
      placeholder="Optional reflection..."
      class="w-full mt-2 p-2 border rounded-lg"
      rows="3"
    ></textarea>
    <button class="w-full bg-indigo-600 text-white py-2 rounded-lg">
      Save Mood
    </button>
  </div>

</div>

<script>
  // Initialize map (start zoomed out)
  const map = L.map('map', {
    zoomControl: false,
    attributionControl: false
  }).setView([20, 0], 2);

  // Calm tiles
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    maxZoom: 18
  }).addTo(map);

  // Pulse marker
  const pulseIcon = L.divIcon({
    className: '',
    html: '<div class="pulse"></div>',
    iconSize: [14, 14]
  });

  let marker;

  function arriveAtLocation(lat, lng) {
    map.flyTo([lat, lng], 13, {
      animate: true,
      duration: 1.2,
      easeLinearity: 0.25
    });

    setTimeout(() => {
      marker = L.marker([lat, lng], { icon: pulseIcon }).addTo(map);
      document.getElementById('moodPanel').classList.remove('hidden');
    }, 1200);
  }

  // Geolocation
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        arriveAtLocation(pos.coords.latitude, pos.coords.longitude);
      },
      () => {
        // Fallback: calm default location
        arriveAtLocation(-33.8688, 151.2093); // Sydney
      }
    );
  } else {
    arriveAtLocation(-33.8688, 151.2093);
  }
</script>

</body>
</html>