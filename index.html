<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MoodSpace ğŸŒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    #map { height: 420px; }
  </style>
</head>

<body class="bg-slate-100 text-slate-900 transition-colors" id="body">

<div class="max-w-5xl mx-auto p-4 space-y-6">

  <!-- HEADER -->
  <header class="flex justify-between items-center">
    <h1 class="text-3xl font-bold">MoodSpace ğŸŒ</h1>
    <button id="darkToggle" class="px-3 py-1 rounded bg-slate-800 text-white">
      ğŸŒ™
    </button>
  </header>

  <!-- FORM -->
  <form id="moodForm" class="bg-white p-4 rounded-xl shadow space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="font-semibold">Color</label>
        <input id="color" type="color" value="#ffcc00" class="w-full h-10">
      </div>

      <div>
        <label class="font-semibold">Emoji</label>
        <select id="emoji" class="w-full p-2 border rounded">
          <option>ğŸ˜„</option>
          <option>ğŸ˜Œ</option>
          <option>ğŸ˜¢</option>
          <option>ğŸ˜ </option>
          <option>ğŸ˜´</option>
          <option>ğŸ¤¯</option>
        </select>
      </div>

      <div>
        <label class="font-semibold">Tag</label>
        <input id="tag" type="text" placeholder="grateful"
               class="w-full p-2 border rounded">
      </div>
    </div>

    <button class="w-full bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">
      Share Mood
    </button>
  </form>

  <!-- MAP -->
  <div id="map" class="rounded-xl shadow"></div>

  <!-- STATS -->
  <section class="bg-white p-4 rounded-xl shadow">
    <h2 class="text-xl font-bold mb-2">Mood Stats</h2>
    <div id="stats" class="flex gap-4 flex-wrap"></div>
  </section>

  <!-- FEED -->
  <section class="bg-white p-4 rounded-xl shadow">
    <h2 class="text-xl font-bold mb-2">Recent Moods</h2>
    <ul id="feed" class="space-y-2"></ul>
  </section>

</div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ============================
   ğŸ”¥ FIREBASE CONFIG
   ============================ */
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
});
const db = firebase.firestore();

/* ============================
   ğŸŒ MAP
   ============================ */
const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'Â© OpenStreetMap'
}).addTo(map);

/* ============================
   ğŸ§  STATE
   ============================ */
const stats = {};
const feed = document.getElementById("feed");
const statsBox = document.getElementById("stats");

/* ============================
   ğŸ“ ADD MARKER
   ============================ */
function addMarker(m) {
  const icon = L.divIcon({
    html:`<div style="
      background:${m.color};
      width:32px;height:32px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;">${m.emoji}</div>`
  });
  L.marker([m.lat,m.lng],{icon})
   .addTo(map)
   .bindPopup(`<b>${m.tag}</b>`);
}

/* ============================
   ğŸ“Š UPDATE STATS
   ============================ */
function updateStats(emoji){
  stats[emoji]=(stats[emoji]||0)+1;
  statsBox.innerHTML="";
  Object.keys(stats).forEach(e=>{
    const div=document.createElement("div");
    div.className="px-3 py-1 bg-slate-200 rounded";
    div.innerText=`${e} ${stats[e]}`;
    statsBox.appendChild(div);
  });
}

/* ============================
   ğŸ“° UPDATE FEED
   ============================ */
function addFeed(m){
  const li=document.createElement("li");
  li.innerText=`${m.emoji} ${m.tag}`;
  feed.prepend(li);
}

/* ============================
   â˜ï¸ LOAD EXISTING
   ============================ */
db.collection("moods").orderBy("ts","desc").limit(50).get()
.then(snap=>{
  snap.forEach(doc=>{
    const m=doc.data();
    addMarker(m);
    updateStats(m.emoji);
    addFeed(m);
  });
});

/* ============================
   âœï¸ FORM SUBMIT
   ============================ */
document.getElementById("moodForm").addEventListener("submit",e=>{
  e.preventDefault();
  const m={
    color:color.value,
    emoji:emoji.value,
    tag:tag.value||"mood",
    ts:firebase.firestore.FieldValue.serverTimestamp()
  };

  navigator.geolocation.getCurrentPosition(pos=>{
    m.lat=pos.coords.latitude;
    m.lng=pos.coords.longitude;

    db.collection("moods").add(m);
    addMarker(m);
    updateStats(m.emoji);
    addFeed(m);
    tag.value="";
  });
});

/* ============================
   ğŸŒ™ DARK MODE
   ============================ */
darkToggle.onclick=()=>{
  document.body.classList.toggle("bg-slate-900");
  document.body.classList.toggle("text-white");
};
</script>

</body>
</html>